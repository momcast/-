<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Survival</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            touch-action: none;
            font-family: 'Pretendard', sans-serif;
        }
        canvas {
            display: block;
        }
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }
        .interactive {
            pointer-events: auto;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .btn-pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <!-- ì ìˆ˜ í‘œì‹œ -->
        <div id="score-board" class="absolute top-5 left-5 text-2xl font-bold opacity-80">
            ì ìˆ˜: <span id="current-score">0</span>
        </div>

        <!-- ì‹œì‘ í™”ë©´ -->
        <div id="start-screen" class="flex flex-col items-center bg-black/60 p-10 rounded-3xl backdrop-blur-md border border-white/20">
            <h1 class="text-5xl font-black mb-4 tracking-tighter">SPACE SURVIVAL</h1>
            <p class="text-gray-300 mb-8 text-center">ìš´ì„ì„ í”¼í•´ ìµœëŒ€í•œ ì˜¤ë˜ ì‚´ì•„ë‚¨ìœ¼ì„¸ìš”!<br>(ë§ˆìš°ìŠ¤ ë˜ëŠ” í„°ì¹˜ë¡œ ì´ë™)</p>
            <button id="start-btn" class="interactive btn-pulse bg-indigo-600 hover:bg-indigo-500 text-white px-8 py-3 rounded-full font-bold text-xl transition-all shadow-lg shadow-indigo-500/50">
                ê²Œì„ ì‹œì‘
            </button>
        </div>

        <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
        <div id="game-over-screen" class="hidden flex flex-col items-center bg-black/80 p-10 rounded-3xl backdrop-blur-md border border-red-500/30">
            <h2 class="text-4xl font-bold text-red-500 mb-2">GAME OVER</h2>
            <p class="text-xl mb-6">ìµœì¢… ì ìˆ˜: <span id="final-score">0</span></p>
            <button id="restart-btn" class="interactive bg-white text-black px-8 py-3 rounded-full font-bold text-xl hover:bg-gray-200 transition-all">
                ë‹¤ì‹œ ì‹œë„
            </button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('current-score');
        const finalScoreElement = document.getElementById('final-score');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        // ê²Œì„ ìƒíƒœ
        let gameState = 'START'; // START, PLAYING, GAMEOVER
        let score = 0;
        let animationId;
        let enemies = [];
        let particles = [];
        let lastEnemyTime = 0;
        let enemySpawnInterval = 1000;

        // í”Œë ˆì´ì–´ ì„¤ì •
        const player = {
            x: 0,
            y: 0,
            size: 40,
            targetX: 0,
            targetY: 0,
            emoji: 'ğŸš€'
        };

        // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì ˆ
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.x = canvas.width / 2;
            player.y = canvas.height * 0.8;
            player.targetX = player.x;
            player.targetY = player.y;
        }

        window.addEventListener('resize', resize);
        resize();

        // ì…ë ¥ ì²˜ë¦¬ (ë§ˆìš°ìŠ¤ & í„°ì¹˜)
        function updatePosition(e) {
            if (gameState !== 'PLAYING') return;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            player.targetX = clientX;
            player.targetY = clientY;
        }

        window.addEventListener('mousemove', updatePosition);
        window.addEventListener('touchmove', updatePosition);

        // ì (ìš´ì„) í´ë˜ìŠ¤
        class Enemy {
            constructor() {
                this.size = Math.random() * 40 + 20;
                this.x = Math.random() * canvas.width;
                this.y = -this.size;
                this.speed = Math.random() * 3 + 2 + (score / 1000);
                this.rotation = 0;
                this.rotationSpeed = (Math.random() - 0.5) * 0.1;
                this.emoji = ['â˜„ï¸', 'ğŸŒ‘', 'ğŸ‘¾', 'ğŸ’¥'][Math.floor(Math.random() * 4)];
            }

            update() {
                this.y += this.speed;
                this.rotation += this.rotationSpeed;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.font = `${this.size}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.emoji, 0, 0);
                ctx.restore();
            }
        }

        // íŒŒí‹°í´(íš¨ê³¼ìŒ ëŒ€ì‹  ì‹œê° íš¨ê³¼)
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.size = Math.random() * 5 + 2;
                this.speedX = (Math.random() - 0.5) * 10;
                this.speedY = (Math.random() - 0.5) * 10;
                this.life = 1.0;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= 0.02;
            }
            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }
        }

        function initGame() {
            score = 0;
            enemies = [];
            particles = [];
            enemySpawnInterval = 1000;
            scoreElement.innerText = '0';
            gameState = 'PLAYING';
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            animate();
        }

        function gameOver() {
            gameState = 'GAMEOVER';
            cancelAnimationFrame(animationId);
            finalScoreElement.innerText = Math.floor(score);
            gameOverScreen.classList.remove('hidden');
            
            // í­ë°œ íš¨ê³¼
            for(let i=0; i<30; i++) {
                particles.push(new Particle(player.x, player.y, '#ff5500'));
            }
        }

        function animate(timestamp = 0) {
            if (gameState !== 'PLAYING') {
                // ê²Œì„ ì˜¤ë²„ ìƒíƒœì—ì„œë„ íŒŒí‹°í´ì€ ê·¸ë ¤ì¤Œ
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                particles.forEach((p, i) => {
                    p.update();
                    p.draw();
                    if(p.life <= 0) particles.splice(i, 1);
                });
                if(gameState === 'GAMEOVER' && particles.length > 0) {
                    animationId = requestAnimationFrame(animate);
                }
                return;
            }

            ctx.fillStyle = 'rgba(10, 10, 25, 0.4)'; // ì”ìƒ íš¨ê³¼
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ë³„ ë°°ê²½ (ë‹¨ìˆœí•˜ê²Œ)
            if(Math.random() > 0.9) {
                ctx.fillStyle = 'white';
                ctx.fillRect(Math.random() * canvas.width, 0, 2, 2);
            }

            // í”Œë ˆì´ì–´ ì´ë™ (ë¶€ë“œëŸ½ê²Œ)
            player.x += (player.targetX - player.x) * 0.15;
            player.y += (player.targetY - player.y) * 0.15;

            // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸°
            ctx.font = `${player.size}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(player.emoji, player.x, player.y);

            // ì  ìƒì„±
            if (timestamp - lastEnemyTime > enemySpawnInterval) {
                enemies.push(new Enemy());
                lastEnemyTime = timestamp;
                // ë‚œì´ë„ ìƒìŠ¹
                enemySpawnInterval = Math.max(200, 1000 - (score / 50));
            }

            // ì  ì—…ë°ì´íŠ¸ ë° ê·¸ë¦¬ê¸°
            enemies.forEach((enemy, index) => {
                enemy.update();
                enemy.draw();

                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (enemy.y > canvas.height + enemy.size) {
                    enemies.splice(index, 1);
                    score += 10;
                    scoreElement.innerText = Math.floor(score);
                }

                // ì¶©ëŒ ê²€ì‚¬
                const dist = Math.hypot(player.x - enemy.x, player.y - enemy.y);
                if (dist < (player.size/2 + enemy.size/2) - 10) {
                    gameOver();
                }
            });

            // íŒŒí‹°í´ ì²˜ë¦¬
            particles.forEach((p, i) => {
                p.update();
                p.draw();
                if(p.life <= 0) particles.splice(i, 1);
            });

            animationId = requestAnimationFrame(animate);
        }

        startBtn.addEventListener('click', initGame);
        restartBtn.addEventListener('click', initGame);

        // ì´ˆê¸° í™”ë©´ ê·¸ë¦¬ê¸°
        ctx.fillStyle = '#0a0a19';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

    </script>
</body>
</html>
